<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beame AI Analysis - Transform Your Smile</title>
    <link rel="icon" type="image/jpeg" href="../beame favicon.jpg">
    <link rel="stylesheet" href="./style.css">
</head>
<body class="app-body">
    <!-- Navigation Bar (Consistent with Landing Page) -->
    <nav class="fixed-top">
        <div class="navbar-container">
            <div class="logo-container">
                <a href="../landing/index.html" class="logo">
                    <img src="../landing/pics/beamelogogreen.png" alt="Beame Logo">
                </a>
            </div>
            <div class="nav-right">
                <div class="language-switcher">
                    <button class="lang-btn" data-lang="zh" id="lang-zh">中文</button>
                    <button class="lang-btn" data-lang="en" id="lang-en">EN</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="app-container">
        <header class="app-header">
            <h1 data-en="AI Smile Analysis" data-zh="AI 笑容分析">AI Smile Analysis</h1>
            <p class="subtitle" data-en="Let our AI guide your transformation" data-zh="讓我們的 AI 引導您的轉變">Let our AI guide your transformation</p>
        </header>

        <main class="app-main">
            <!-- Camera / Scanning Section -->
            <div class="scanning-section" id="webcamSection">
                <div class="camera-card">
                    <div class="video-container">
                        <video id="webcam" autoplay playsinline muted></video>
                        <canvas id="output" class="output-canvas"></canvas>
                        
                        <!-- Start Overlay -->
                        <div id="cameraStartOverlay" class="camera-start-overlay">
                            <div class="start-content">
                                <div class="start-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="start-icon-svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" />
                                    </svg>
                                </div>
                                <h2 data-en="Tap to start camera" data-zh="點擊啟動攝像頭">Tap to start camera</h2>
                                <p data-en="Allow camera access to analyze your smile" data-zh="允許訪問攝像頭以分析您的笑容">Allow camera access to analyze your smile</p>
                            </div>
                        </div>
                        
                        <!-- Intelligent HUD Overlay -->
                        <div class="camera-hud">
                            <div class="hud-top">
                                <div class="status-badge" id="cameraStatusBadge">
                                    <span class="status-dot"></span>
                                    <span id="cameraStatus" data-en="Initializing..." data-zh="正在啟動...">Initializing...</span>
                                </div>
                            </div>
                            <div class="hud-center">
                            </div>
                            <div class="hud-bottom">
                                <!-- Removed mouth-instruction from here to avoid blocking camera view -->
                            </div>
                        </div>
                    </div>

                    <div class="camera-controls">
                        <button id="captureBtn" class="btn-capture" disabled>
                            <div class="btn-capture-inner"></div>
                        </button>
                        <span class="btn-label" data-en="Capture" data-zh="拍攝">Capture</span>
                    </div>
                </div>

                <!-- Live Status Panel -->
                <div class="app-status-panel" id="statusPanel">
                    <div class="status-pill">
                        <span class="label" data-en="FACE DETECTION" data-zh="面部檢測">FACE DETECTION</span>
                        <span class="value" id="faceStatus" data-en="Waiting..." data-zh="等待中...">Waiting...</span>
                    </div>
                    <div class="status-pill">
                        <span class="label" data-en="ALIGNMENT" data-zh="排列分析">ALIGNMENT</span>
                        <span class="value" id="analysisStatus" data-en="Ready" data-zh="就緒">Ready</span>
                    </div>
                    <div class="status-pill">
                        <span class="label" data-en="TEETH DETECTED" data-zh="牙齒偵測">TEETH DETECTED</span>
                        <span class="value" id="teethStatus">-</span>
                    </div>
                </div>
                <p class="status-hint" data-en="Try to get as many teeth detected as possible for better analysis" data-zh="嘗試捕捉更多牙齒以獲得更好的分析結果">
                    Try to get as many teeth detected as possible for better analysis
                </p>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection" style="display: none;">
                <!-- Result Navigation -->
                <div class="results-header">
                    <div class="result-steps">
                        <div class="res-step active" id="step1">
                            <span class="num">1</span>
                            <span class="txt" data-en="AI Generation" data-zh="AI 生成">AI Generation</span>
                        </div>
                        <div class="res-step-line"></div>
                        <div class="res-step" id="step2">
                            <span class="num">2</span>
                            <span class="txt" data-en="Detailed Report" data-zh="詳細報告">Detailed Report</span>
                        </div>
                    </div>
                </div>

                <!-- Tab Navigation -->
                <div class="app-tabs">
                    <button class="tab-item active" data-tab="preview" onclick="switchTab('preview')">
                        <span class="icon">
                            <svg class="icon-svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" />
                            </svg>
                        </span>
                        <span class="label" data-en="AI Preview" data-zh="AI 預覽">AI Preview</span>
                    </button>
                    <button class="tab-item disabled" data-tab="plan" onclick="switchTab('plan')" id="planTabBtn" disabled>
                        <span class="icon">
                            <svg class="icon-svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m.75-12h-.872a2.25 2.25 0 0 0-4.256 0h-.872a2.25 2.25 0 0 0-2.25 2.25v11.25a2.25 2.25 0 0 0 2.25 2.25h11.25a2.25 2.25 0 0 0 2.25-2.25V8.25a2.25 2.25 0 0 0-2.25-2.25Z" />
                            </svg>
                        </span>
                        <span class="label" data-en="Treatment" data-zh="治療方案">Treatment</span>
                    </button>
                    <button class="tab-item disabled" data-tab="3d" onclick="switchTab('3d')" id="3dTabBtn" disabled>
                        <span class="icon">
                            <svg class="icon-svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                            </svg>
                        </span>
                        <span class="label" data-en="Photo Scan" data-zh="拍攝掃描">Photo Scan</span>
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="app-tab-content">
                    <!-- Tab 1: AI Preview -->
                    <div class="tab-pane active" id="tab-preview">
                        <div class="preview-comparison">
                            <div class="comparison-grid">
                                <div class="img-box">
                                    <span class="tag" data-en="Original" data-zh="原始照片">Original</span>
                                    <div class="img-wrap">
                                        <img id="originalImage" alt="Original">
                                    </div>
                                </div>
                                <div class="comparison-arrow">→</div>
                                <div class="img-box result">
                                    <span class="tag primary" data-en="AI Result" data-zh="AI 效果">AI Result</span>
                                    <div class="img-wrap">
                                        <div class="processing-loader" id="processingIndicator">
                                            <div class="scanner-line"></div>
                                            <p id="analysisStep">Analyzing...</p>
                                        </div>
                                        <img id="straightenedImage" alt="Result" style="display: none;">
                                    </div>
                                </div>
                            </div>
                            <div class="ai-notice">
                                <span class="icon">
                                    <svg class="icon-svg-sm" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6 6 0 1 0-9 4.306c.066.413.147.821.243 1.224A.241.241 0 0 0 3.481 19h17.039a.241.241 0 0 0 .238-.17c.096-.403.177-.811.243-1.224A6 6 0 0 0 12 12.75Z" />
                                    </svg>
                                </span>
                                <p data-en="This is an AI-generated simulation. Results may vary after clinical review." 
                                   data-zh="這是 AI 生成的模擬效果。實際結果可能在臨床審核後有所不同。">
                                   This is an AI-generated simulation. Results may vary after clinical review.
                                </p>
                            </div>
                        </div>
                        
                        <div class="actions-row">
                            <button id="downloadBtn" class="btn-app btn-outline" style="display: none;">
                                <svg class="icon-svg-sm" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="margin-right: 8px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M7.5 12 12 16.5m0 0L16.5 12M12 16.5V3" />
                                </svg>
                                <span data-en="Save Photo" data-zh="保存照片">Save Photo</span>
                            </button>
                            <button id="retryBtn" class="btn-app btn-primary">
                                <svg class="icon-svg-sm" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="margin-right: 8px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" />
                                </svg>
                                <span data-en="New Scan" data-zh="重新掃描">New Scan</span>
                            </button>
                        </div>
                    </div>

                    <!-- Tab 2: Treatment Plan -->
                    <div class="tab-pane" id="tab-plan">
                        <div class="plan-report">
                            <div class="details-section" id="aiAssessmentSection">
                                <h4 data-en="AI Assessment" data-zh="AI 初步評估">AI Assessment</h4>

                                <div class="ai-notice">
                                    <span class="icon">
                                        <svg class="icon-svg-sm" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                                        </svg>
                                    </span>
                                    <p data-en="This is an AI-based assessment from a photo and is not a medical diagnosis. A dentist/orthodontist can provide the best assessment and confirm next steps."
                                       data-zh="此為基於照片的 AI 初步評估，並非醫療診斷。牙醫／矯正專科醫師可提供最佳評估並確認下一步。">
                                       This is an AI-based assessment from a photo and is not a medical diagnosis. A dentist/orthodontist can provide the best assessment and confirm next steps.
                                    </p>
                                </div>

                                <div class="case-status">
                                    <div class="case-visualizer">
                                        <div class="case-tier tier-mild" id="tier-MILD">
                                            <span class="tier-label" data-en="MILD" data-zh="輕度">MILD</span>
                                        </div>
                                        <div class="case-tier tier-moderate" id="tier-MODERATE">
                                            <span class="tier-label" data-en="MODERATE" data-zh="中度">MODERATE</span>
                                        </div>
                                        <div class="case-tier tier-complex" id="tier-COMPLEX">
                                            <span class="tier-label" data-en="COMPLEX" data-zh="複雜度">COMPLEX</span>
                                        </div>
                                        <div class="case-tier tier-urgent" id="tier-URGENT">
                                            <span class="tier-label" data-en="URGENT" data-zh="緊急">URGENT</span>
                                        </div>
                                    </div>
                                    <span class="case-meta" id="assessmentMeta"></span>
                                </div>

                                <div class="case-cards" id="caseCards">
                                    <div class="case-card" id="caseCard-MILD" data-case="MILD">
                                        <div class="case-head">
                                            <h3 data-en="Mild alignment pattern" data-zh="輕度排列型態">Mild alignment pattern</h3>
                                            <span class="urgency low" data-en="Low urgency" data-zh="低緊急度">Low urgency</span>
                                        </div>
                                        <p class="case-desc"
                                           data-en="Your photo looks consistent with minor crowding/spacing or mild rotation. Many mild cases can be aligner-friendly, but a clinician should confirm."
                                           data-zh="您的照片看起來像是輕微擁擠／間隙或輕度扭轉。許多輕度情況可能適合隱形牙套，但仍需臨床確認。">
                                           Your photo looks consistent with minor crowding/spacing or mild rotation. Many mild cases can be aligner-friendly, but a clinician should confirm.
                                        </p>
                                        <ul class="case-list">
                                            <li data-en="Next: take 3 photos (front, left, right) in good lighting for a more complete review."
                                                data-zh="下一步：在良好光線下拍攝 3 張照片（正面、左側、右側），以便更完整評估。">
                                                Next: take 3 photos (front, left, right) in good lighting for a more complete review.
                                            </li>
                                            <li data-en="Book a consult within the next 2–4 weeks to confirm fit and treatment options."
                                                data-zh="建議於 2–4 週內預約諮詢，確認適配度與治療選項。">
                                                Book a consult within the next 2–4 weeks to confirm fit and treatment options.
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="case-card" id="caseCard-MODERATE" data-case="MODERATE">
                                        <div class="case-head">
                                            <h3 data-en="Moderate alignment pattern" data-zh="中度排列型態">Moderate alignment pattern</h3>
                                            <span class="urgency medium" data-en="Medium urgency" data-zh="中等緊急度">Medium urgency</span>
                                        </div>
                                        <p class="case-desc"
                                           data-en="Your photo may show moderate crowding/rotation/spacing. This often benefits from an orthodontic plan and may require attachments/IPR."
                                           data-zh="您的照片可能呈現中度擁擠／扭轉／間隙。通常需要矯正計畫，並可能需要附件或修磨（IPR）。">
                                           Your photo may show moderate crowding/rotation/spacing. This often benefits from an orthodontic plan and may require attachments/IPR.
                                        </p>
                                        <ul class="case-list">
                                            <li data-en="Next: book a consult within 1–2 weeks for an in-depth assessment."
                                                data-zh="下一步：建議於 1–2 週內預約諮詢，進行更深入評估。">
                                                Next: book a consult within 1–2 weeks for an in-depth assessment.
                                            </li>
                                            <li data-en="If you have jaw clicking, bite discomfort, or headaches, mention it during your consult."
                                                data-zh="若有顳顎關節喀喀聲、咬合不適或頭痛，請在諮詢時告知。">
                                                If you have jaw clicking, bite discomfort, or headaches, mention it during your consult.
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="case-card" id="caseCard-COMPLEX" data-case="COMPLEX">
                                        <div class="case-head">
                                            <h3 data-en="Complex orthodontic pattern" data-zh="複雜矯正型態">Complex orthodontic pattern</h3>
                                            <span class="urgency high" data-en="Higher urgency" data-zh="較高緊急度">Higher urgency</span>
                                        </div>
                                        <p class="case-desc"
                                           data-en="Your photo may suggest a more complex alignment/bite pattern (e.g., severe crowding, significant bite issues). These cases often need an orthodontist-led plan."
                                           data-zh="您的照片可能顯示較複雜的排列／咬合型態（例如嚴重擁擠、明顯咬合問題）。此類情況通常需要矯正專科醫師主導規劃。">
                                           Your photo may suggest a more complex alignment/bite pattern (e.g., severe crowding, significant bite issues). These cases often need an orthodontist-led plan.
                                        </p>
                                        <ul class="case-list">
                                            <li data-en="Next: schedule an orthodontic consult soon (ideally within 7–14 days)."
                                                data-zh="下一步：建議盡快安排矯正諮詢（理想為 7–14 天內）。">
                                                Next: schedule an orthodontic consult soon (ideally within 7–14 days).
                                            </li>
                                            <li data-en="You may need in-person records (x‑rays/scan) to confirm whether aligners or braces are appropriate."
                                                data-zh="可能需要面診資料（X 光／口掃）以確認是否適合隱形牙套或需傳統矯正。">
                                                You may need in-person records (x‑rays/scan) to confirm whether aligners or braces are appropriate.
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="case-card" id="caseCard-URGENT" data-case="URGENT">
                                        <div class="case-head">
                                            <h3 data-en="Possible urgent dental concern" data-zh="可能有緊急牙科狀況">Possible urgent dental concern</h3>
                                            <span class="urgency urgent" data-en="Urgent" data-zh="緊急">Urgent</span>
                                        </div>
                                        <p class="case-desc"
                                           data-en="Your photo may show signs that should be evaluated promptly (e.g., swelling, bleeding, infection/trauma concerns). Please seek professional care."
                                           data-zh="您的照片可能出現需要盡快評估的跡象（例如腫脹、出血、感染／外傷疑慮）。請儘速就醫。">
                                           Your photo may show signs that should be evaluated promptly (e.g., swelling, bleeding, infection/trauma concerns). Please seek professional care.
                                        </p>
                                        <ul class="case-list">
                                            <li data-en="Next: contact a dentist within 24–48 hours. If you have fever, spreading swelling, severe pain, or difficulty swallowing/breathing, seek emergency care."
                                                data-zh="下一步：請在 24–48 小時內聯絡牙醫。若有發燒、腫脹擴散、劇痛或吞嚥／呼吸困難，請立即就醫急診。">
                                                Next: contact a dentist within 24–48 hours. If you have fever, spreading swelling, severe pain, or difficulty swallowing/breathing, seek emergency care.
                                            </li>
                                            <li data-en="Orthodontic planning (aligners/braces) should wait until urgent issues are ruled out or treated."
                                                data-zh="在排除或治療緊急狀況前，矯正規劃（隱形牙套／傳統矯正）應先暫緩。">
                                                Orthodontic planning (aligners/braces) should wait until urgent issues are ruled out or treated.
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="eligibility-banner" id="eligibilityCard">
                                <div class="badge" id="eligibilityBadge">
                                    <span id="eligibilityStatus">...</span>
                                </div>
                                <p id="eligibilityMessage"></p>
                            </div>

                            <div class="metrics-grid" id="treatmentDetails" style="display: none;">
                                <div class="metric-card">
                                    <div class="icon">
                                        <svg class="icon-svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
                                        </svg>
                                    </div>
                                    <div class="data">
                                        <label data-en="Duration" data-zh="療程週期">Duration</label>
                                        <span id="treatmentLength">-</span>
                                    </div>
                                </div>
                                <div class="metric-card">
                                    <div class="icon">
                                        <svg class="icon-svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                                        </svg>
                                    </div>
                                    <div class="data">
                                        <label data-en="Aligners" data-zh="牙套數量">Aligners</label>
                                        <span id="stageCount">-</span>
                                    </div>
                                </div>
                                <div class="metric-card">
                                    <div class="icon">
                                        <svg class="icon-svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                                        </svg>
                                    </div>
                                    <div class="data">
                                        <label data-en="Wear Type" data-zh="佩戴方式">Wear Type</label>
                                        <span id="wearType">-</span>
                                    </div>
                                </div>
                            </div>

                            <div class="details-section">
                                <h4 data-en="Recommended Corrections" data-zh="建議修正項目">Recommended Corrections</h4>
                                <div class="tags-cloud" id="correctionsList"></div>
                            </div>

                            <div class="details-section">
                                <h4 data-en="Clinical Assessment" data-zh="臨床評估建議">Clinical Assessment</h4>
                                <ul class="check-list" id="treatmentReasons"></ul>
                            </div>
                        </div>
                    </div>

                    <!-- Tab 3: Photo Scan (4-stage capture) -->
                    <div class="tab-pane" id="tab-3d">
                        <div class="camera-card capture4-card">
                            <div class="video-container">
                                <video id="stageWebcam" autoplay playsinline muted></video>
                                <canvas id="stageOverlay" class="output-canvas"></canvas>
                                
                                <!-- Intelligent HUD Overlay -->
                                <div class="camera-hud">
                                    <div class="hud-top">
                                        <div class="status-badge ready" id="stageReadyBadge">
                                            <span class="status-dot"></span>
                                            <span id="stageReadyText">Align to continue</span>
                                        </div>
                                        <div class="capture-step-badge">
                                            <span id="stageStep">1 of 4</span>
                                        </div>
                                    </div>
                                    <div class="hud-center">
                                        <!-- CV alignment guides drawn on canvas -->
                                    </div>
                                    <div class="hud-bottom">
                                        <!-- Instructions moved to controls area -->
                                    </div>
                                </div>
                            </div>

                            <div class="camera-controls">
                                <div class="stage-instruction-container">
                                    <h3 id="stageTitle" data-en="Front Open View" data-zh="正面張口視圖">Front Open View</h3>
                                    <p id="stageInstruction" data-en="Open your mouth wide to clearly show all your front teeth. Align your mouth within the guides." data-zh="請將嘴巴張大，清楚展示您的所有前牙。請將您的嘴巴對準導引框。">Open your mouth wide to clearly show all your front teeth. Align your mouth within the guides.</p>
                                </div>
                                <div class="stage-actions">
                                    <button id="stageRetakeBtn" class="btn-app btn-outline sm">
                                        <span data-en="Retake" data-zh="重拍">Retake</span>
                                    </button>
                                    
                                    <div class="capture-trigger">
                                        <button id="stageCaptureBtn" class="btn-capture" disabled>
                                            <div class="btn-capture-inner"></div>
                                        </button>
                                        <span class="btn-label" data-en="Capture" data-zh="拍攝">Capture</span>
                                    </div>

                                    <button id="stageCompleteBtn" class="btn-app btn-primary sm" style="display: none;">
                                        <span data-en="Done" data-zh="完成">Done</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Thumbnails Row -->
                        <div class="capture4-thumbs-container">
                            <div class="capture4-thumbs">
                                <button class="thumb-btn active" id="thumb-0">
                                    <img id="thumbImg-0" alt="Front Smile" style="display: none;" />
                                    <span class="thumb-label">FRONT</span>
                                </button>
                                <button class="thumb-btn" id="thumb-1">
                                    <img id="thumbImg-1" alt="Lower Front" style="display: none;" />
                                    <span class="thumb-label">LOWER</span>
                                </button>
                                <button class="thumb-btn" id="thumb-2">
                                    <img id="thumbImg-2" alt="Upper Front" style="display: none;" />
                                    <span class="thumb-label">UPPER</span>
                                </button>
                                <button class="thumb-btn" id="thumb-3">
                                    <img id="thumbImg-3" alt="Side Bite" style="display: none;" />
                                    <span class="thumb-label">SIDE</span>
                                </button>
                            </div>
                        </div>

                        <!-- Interest Form (Appears after 4 photos) -->
                        <div id="stageForm" class="interest-form" style="display: none;">
                            <div class="form-header">
                                <h3 data-en="Complete Your Profile" data-zh="完成您的個人資料">Complete Your Profile</h3>
                                <p data-en="Our specialists will review your 4 scans and contact you with a detailed clinical assessment." 
                                   data-zh="我們的專員將審核您的 4 張掃描照片，並聯絡您提供詳細的臨床評估。">
                                   Our specialists will review your 4 scans and contact you with a detailed clinical assessment.
                                </p>
                            </div>
                            
                            <div class="form-body">
                                <div class="form-group">
                                    <label for="userName" data-en="Preferred Name" data-zh="稱呼">Preferred Name</label>
                                    <input type="text" id="userName" placeholder="e.g. Alex">
                                </div>
                                
                                <div class="form-group">
                                    <label for="userEmail" data-en="Email Address" data-zh="電子郵件">Email Address</label>
                                    <input type="email" id="userEmail" placeholder="example@email.com">
                                </div>
                                
                                <div class="form-group">
                                    <label for="userPhone" data-en="Phone Number" data-zh="電話號碼">Phone Number</label>
                                    <input type="tel" id="userPhone" placeholder="9123 4567 (HK) or 138 0013 8000 (CN)">
                                </div>

                                <div class="form-notice">
                                    <svg class="icon-svg-sm" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z" />
                                    </svg>
                                    <span data-en="Your data is encrypted and secure." data-zh="您的數據已加密且安全。">Your data is encrypted and secure.</span>
                                </div>
                                
                                <button id="finalSubmitBtn" class="btn-app btn-primary full-width">
                                    <span data-en="Submit My Scans" data-zh="提交我的掃描">Submit My Scans</span>
                                </button>
                            </div>
                        </div>

                        <p class="capture4-hint" id="captureHint" data-en="Capture all 4 angles for the best assessment." data-zh="拍攝 4 個角度以獲得最佳評估。">
                            Capture all 4 angles for the best assessment.
                        </p>
                    </div>
                </div>
            </div>
        </main>

        <footer class="app-footer">
            <img src="../landing/pics/beamelogogreen.png" alt="Beame Logo" class="footer-logo">
            <p>&copy; 2026 Beame AI - <span data-en="Transforming Smiles" data-zh="改變笑容">Transforming Smiles</span></p>
        </footer>
    </div>

    <!-- Completion Modal -->
    <div id="completionModal" class="modal-overlay" style="display: none;">
        <div class="modal-card success-modal">
            <div class="modal-header">
                <div class="success-icon-wrap">
                    <svg class="success-svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
                <h2 data-en="Submission Successful!" data-zh="提交成功！">Submission Successful!</h2>
                <p data-en="Your scans have been sent to our clinical team." data-zh="您的掃描已發送至我們的臨床團隊。">Your scans have been sent to our clinical team.</p>
            </div>
            
            <div class="modal-body">
                <p class="modal-hint" data-en="What would you like to do next?" data-zh="您接下來想做什麼？">What would you like to do next?</p>
                <div class="modal-actions-vertical">
                    <button id="modalDownloadBtn" class="btn-app btn-primary full-width">
                        <svg class="icon-svg-sm" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M7.5 12 12 16.5m0 0L16.5 12M12 16.5V3" />
                        </svg>
                        <span data-en="Download My AI Results" data-zh="下載我的 AI 結果">Download My AI Results</span>
                    </button>
                    <a href="../landing/index.html" class="btn-app btn-outline full-width">
                        <svg class="icon-svg-sm" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                        </svg>
                        <span data-en="Back to Home" data-zh="返回主頁">Back to Home</span>
                    </a>
                </div>
            </div>
            
            <button class="modal-close-minimal" onclick="document.getElementById('completionModal').style.display='none'">
                <span data-en="Dismiss" data-zh="關閉">Dismiss</span>
            </button>
        </div>
    </div>

    <script type="module" src="./main.ts"></script>
    <script>
        // Language switching script inside app.html for fast responsive UI
        const switchAppLanguage = (lang) => {
            document.documentElement.lang = lang;
            localStorage.setItem('beame-language', lang);
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });

            document.querySelectorAll('[data-en]').forEach(el => {
                el.textContent = el.getAttribute('data-' + lang);
            });

            // Dispatch event for main.ts to pick up
            window.dispatchEvent(new CustomEvent('languageChanged', { detail: lang }));
        };

        document.getElementById('lang-en').onclick = () => switchAppLanguage('en');
        document.getElementById('lang-zh').onclick = () => switchAppLanguage('zh');

        // Init language
        const savedLang = localStorage.getItem('beame-language') || 'en';
        switchAppLanguage(savedLang);

        // Tab functionality
        function switchTab(tabName) {
            const selectedBtn = document.querySelector('.tab-item[data-tab="' + tabName + '"]');
            if (selectedBtn && selectedBtn.classList.contains('disabled')) return;
            
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(b => b.classList.remove('active'));
            
            const pane = document.getElementById('tab-' + tabName);
            if (pane) pane.classList.add('active');
            if (selectedBtn) selectedBtn.classList.add('active');
            
            if (tabName === '3d' && window.initializeStageCapture) {
                setTimeout(() => window.initializeStageCapture(), 100);
            }
        }
    </script>
</body>
</html>
